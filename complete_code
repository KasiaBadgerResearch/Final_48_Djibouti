# How has the prevalence of obesity among adult women evolved relative to that among adult men in Djibouti between 1975 and 2015?

import pandas as pd
import matplotlib.pyplot as plt
import os

# Folders
data_raw_folder = "data_raw/"
data_clean_folder = "data_clean/"
figures_folder = "figures/"

# Load CSV
filename = "gender_dji_filtered.csv"  # Filtered dataset with only relevant rows
df = pd.read_csv(os.path.join(data_raw_folder, filename))

# Keep only needed columns
df = df[["Year", "Indicator Name", "Value"]]

# Convert Year and Value to numeric, drop invalid rows
df["Year"] = pd.to_numeric(df["Year"], errors="coerce")
df["Value"] = pd.to_numeric(df["Value"], errors="coerce")
df = df.dropna(subset=["Year", "Value"])

# Pivot indicators into separate columns
df_pivot = df.pivot(index="Year", columns="Indicator Name", values="Value").reset_index()
df_pivot = df_pivot.sort_values("Year")

print("Pivoted Djidouti dataset:")
display(df_pivot)

# Interpolate missing values for smooth plotting (optional)
df_plot = df_pivot.interpolate(method='linear')

# Plot the indicators
plt.figure(figsize=(10,6))
plt.plot(df_plot["Year"], df_plot["Prevalence of obesity, female (% of female population ages 18+)"], 
         marker='o', linestyle='-', label="Prevalence of obesity, female (% of female population ages 18+)")
plt.plot(df_plot["Year"], df_plot["Prevalence of obesity, male (% of male population ages 18+)"], 
         marker='o', linestyle='-', label="Prevalence of obesity, male (% of male population ages 18+)")

plt.title("Djibouti: Female vs Male prevalence of obesity ages 18+ (%) (1975-2015)")
plt.xlabel("Year")
plt.ylabel("Percentage")
plt.legend()
plt.grid(True)
plt.tight_layout()
plt.savefig(os.path.join(figures_folder, "djibouti_female_vs_male_prevalence_of_obesity_ages_18_plus.png"))
plt.show()

# Save cleaned CSV
df_pivot.to_csv(os.path.join(data_clean_folder, "djibouti_female_vs_male_prevalence_of_obesity_ages_18_plus"), index=False)
